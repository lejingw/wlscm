<!-- 已配货查询 -->
#set($jsfiles = ["$!StringUtil.getContextPath()/dwr/interface/DispatchOrnaDwr.js"])
<form id="frm" action="dispatchOrna.vm?user_action=showDispatched" method="post">
	<input type='hidden' name='headid' value="$!form.condition.headid"/>
	<input type='hidden' name='itemClassId' value="$!form.condition.itemClassId"/>
	<input type='hidden' name='ornaClassId' value="$!form.condition.ornaClassId"/>
	<input type='hidden' name='analysisId' value="$!form.condition.analysisId"/>
	<input type='hidden' name='styleItemClassId' value="$!form.condition.styleItemClassId"/>
	<input type='hidden' name='styleId' value="$!form.condition.styleId"/>
    <table class='list'>
    	<thead>
    		<tr>
                <th width='20px'><input type='checkbox' id='chkall'/></th>
    			<th>商品编码</th><th>商品名称</th><th>计量单位</th><th>款式</th>
				<th>色级</th><th>净度</th><th>总重量</th><th>主石重</th><th>配石重</th><th>尺寸</th><th>网点金额</th>
				<th>配货方式</th><th>说明</th><th>状态</th>
    			<th></th>
    		</tr>
    	</thead>
    	<tbody id='tbl'>
    	#foreach($item in $form.pager.pageData)
    		<tr>
				<td><input type='checkbox' name='chk'/><input type='hidden' name='status' value="$!item.status"/></td>
    			<td>$!item.ornaCode</td>
    			<td>$!item.ornaDsc</td>
    			<td>$!BdCommon.getUnitName($!item.unitId)</td>
				<td>$!HtmlUtil.printStyle($!item.styleId, $!item.styleName, $!item.bigGraph)</td>
    			<td>$!DictUtil.getValue('diacolorgrade',$!item.colorGradeId)</td>
    			<td>$!DictUtil.getValue('diaclean',$!item.cleanId)</td>
    			<td>$!item.allQty</td>
    			<td>$!item.mainWeight</td>
    			<td>$!item.partWeight</td>
    			<td>$!item.sizeName</td>
    			<td>$!item.newPosMoney</td>
    			<td>$!DictUtil.getValue('dispatchFlag', $!item.dispatchFlag)</td>
				<td><input type='text' readonly style='width:90px;' value='#if("1"=="$!{item.isPerfectMatch}")精确匹配#else模糊匹配:#end$!{item.matchRuleDsc}'></td>
				<td>$!DictUtil.getValue('dispatchornastatus',$item.status)</td>
    			<td><input type='button' style='width:40px;' value='删除' #if("2" != "$!item.status")disabled#end onclick="deleteDispatched(this,'$!{item.id}')"/></td>
            </tr>
    	#end
    	</tbody>
    </table>
<script>
createPagingToolbar('frm', $!form.pager.start, $!form.pager.limit, $!form.pager.totalCount);
</script>
</form>
<script>
jQuery(function(){
	checkTable('tbl', 'chkall', 'chk', false);
});
/**
 * 删除已配货记录
 */
function deleteDispatched(obj, ornaLogId){
	var index = obj.parentNode.parentNode.rowIndex-1;
	if("2" != $n("status")[index].value){
		alert("只有已配货状态的才可以删除");
		return ;
	}
	confirm("确定删除配货记录?", function(){
        DispatchOrnaDwr.deleteDispatchLog(ornaLogId, function(data){
			alert(data?data:"删除成功", function(){
				parent.changeDispatchedNum("$!form.condition.useOrderLineIdFlag", "$!form.condition.lineId");
    			jQuery("#frm").submit();
			});
		});
	});
}
</script>