#set($jsfiles = ["$StringUtil.getContextPath()/js/out/consume.js", "$StringUtil.getContextPath()/dwr/interface/ConsumeDwr.js"])

#set($consume = $!form.consume)
#set($lines = $!form.lines)
#if($StringUtil.isBlank($!{consume.billid}))
		#set($billno = "自动生成")
		#set($orgId = $StringUtil.getOrgId($session))
		#set($status = "1")
		#set($createDate = $DateUtil.getCurrentDate10())
		#set($createId = $StringUtil.getUserId($session))
		#set($updateId = $StringUtil.getUserId($session))
		#set($updateDate = $DateUtil.getCurrentDate10())
	#else
		#set($billno = $!{consume.billno})
		#set($orgId = $!{consume.orgId})
		#set($status = $!{consume.status})
		#set($createDate = $!{consume.createDate})
		#set($createId = $!{consume.createId})
		#set($updateId = $!{consume.updateId})
		#set($updateDate = $!{consume.updateDate})
	#end
	#set($enableAdd = false)
	#set($enableSave = false)
	#set($enableCheck = false)
	#set($enableClose = false)
	#set($enablePrint = false)
	#set($isSaved = false)
	#if($StringUtil.isNotBlank($status))
		#if($status == "1")
			#set($enableAdd = true)
			#set($enableSave = true)
			#set($isSaved = true)
			#set($enableCheck = true)
		#elseif($status == "5")##审批完成
			#set($enableClose = true)
			#set($enablePrint = true)
			#set($isSaved = false)
		#elseif($status == "8")##关闭状态
			#set($enablePrint = true)
		#end
	#end
<form id='frm' action="" method="post">
	<input type="hidden" id="billid" value="$!consume.billid"/>
	<input type='hidden' id='status' value="$!status" />
	<input type='hidden' id='orgId' value="$!orgId" />
	<input type='hidden' id="deleteIds" name='deleteIds'  value=""/>
    <table class="title">
    	<tr><td>维修耗料单</td></tr>
    </table>
    <table class="control">
    	<tr><td>
				<input type='button' value='增行' #if(!$enableAdd)disabled#end class='btn' id='btnAdd' $RightUtil.able($session, '08041002','1')>
				<input type='button' value='保存' #if(!$enableSave)disabled#end class='btn' id='btnSave' $RightUtil.able($session, '08041002','2')>
				<input type='button' value='审批' #if(!$enableCheck)disabled#end class='btn' id='btnCheck' $RightUtil.able($session, '08041002','3')>
				<input type='button' value='关闭' #if(!$enableClose)disabled#end class='btn' id='btnClose' $RightUtil.able($session, '08041002','4')>
				<input type='button' value='打印' #if(!$enablePrint)disabled#end class='btn' id="btnPrint" onclick="window.print()">
				<input type='button' value='返回列表' class='btn' id="btnToList">
		</td></tr>
    </table>
		<table class='content'>
			<tr>
				<td class='body1'>单据编号</td>
				<td class='body2'>
					<input type='text' id='billno' readonly value="$!billno">
				</td>
    			<td class='body1'>单据日期：</td>
    			<td class='body2'>
    				<input type='text' id="dodate" name='dodate' readonly #if(!$isSaved)disabled#end value="$!{dodate}" dataType="Require" msg="不能为空">
    			</td>
				<td class='body1'>组织</td>
				<td class='body2'>
					<input type='text' id='orgName' readonly value="$!BdCommon.getOrgName($!orgId)"/>
				</td>
				<td class="body1">供应商</td>
        		<td class='body2'>
					<input type='hidden' id='vendorId' name="vendorId" value="$!{consume.vendorId}">
    				<input type='text' id='vendorName' value="$!BdCommon.getVendorName($!{consume.vendorId})" readonly #if(!$!isSaved)disabled#end class='target' dataType="Require" msg="不能为空" ondblclick="showVendorWin()">
                </td>
			</tr>
			<tr>
				<td class='body1'>金额</td>
				<td class='body2'>
					<input type='text' id='amount'  readOnly dataType="Double" msg='不能为空,且为数字类型' value="$!consume.amount"/>
				</td>
				<td class='body1'>备注</td>
				<td class='body2' colspan="5">
					<input type='text' id='memo' value="$!memo" style="width:90%"/>
				</td>
			</tr>
			<tr>
				<td class='body1'>创建人</td>
				<td class='body2'>
					<input type='hidden' id='createId' readonly value="$!createId">
					<input type='text' id='createname' readonly value="$!BdCommon.getUserName($!createId)">
				</td>
				<td class='body1'>创建时间</td>
				<td class='body2'>
					<input type='text' id='createDate' readonly value="$!createDate"/>
				</td>
				<td class='body1'>修改人</td>
				<td class='body2'>
					<input type='hidden' id='updateId' readonly value="$!updateId">
					<input type='text' id='createname' readonly value="$!BdCommon.getUserName($!updateId)">
				</td>
				<td class='body1'>修改时间</td>
				<td class='body2'>
					<input type='text' id='updateDate' readonly value="$!updateDate"/>
				</td>
			</tr>
			<tr>
				<td class='body1'>状态</td>
				<td class='body2'>
					<input type='text' id='statusName' disabled value="$!DictUtil.getValue('status', $!status)" />
				</td>
			</tr>
		</table>
		<table class='list'>
    	<thead>
			<tr>
				<th></th>
				<th>维护类型</th>
    			<th>大类</th>
				<th>小类</th>
    			<th>成色</th>
    			<th>数量/重量</th>
				<th>主石重量</th>
    			<th>配石重量</th>
    			<th>补石粒数</th>
    			<th>补石重量</th>
    			<th>补石金额</th>
    			<th>加金重量</th>
    			<th>加金金额</th>
    			<th>维修工费(加工费单价)</th>
    			<th>维修金额(加工费)</th>
				<th width='60px'></th>
            </tr>
        </thead>
        <tbody id="tbl">
		#foreach($line in $!lines)
			<tr>
				<td></td>
				<td><select name="dotype" #if(!$!isSaved)disabled#end onchange="checkDotype(this)" style="width:70px" dataType="Require" msg="不能为空"></select></td>
				<td><select name="itemClassId" #if(!$!isSaved)disabled#end onchange="changeOraClass(this, false)" style="width:70px" dataType="Require" msg="不能为空"></select></td>
				<td><select name="ornaClassId" #if(!$!isSaved)disabled#end style="width:70px"></select></td>
				<td><select name="qualityId" #if(!$!isSaved)disabled#end style="width:90px" dataType="Require" msg="不能为空"></select></td>
				<td><input name="allQty" #if(!$!isSaved)readOnly#end value="$!line.allQty" style="width:70px"/></td>
				<td><input name="mainWeight" #if(!$!isSaved)readOnly#end value="$!line.mainWeight" style="width:70px"/></td>
				<td><input name="partWeight" #if(!$!isSaved)readOnly#end value="$!line.partWeight" style="width:70px"/></td>
				<td><input name="addNums" #if(!$!isSaved)readOnly#end value="$!line.addNums" style="width:70px"/></td>
				<td><input name="addWeight" #if(!$!isSaved)readOnly#end value="$!line.addWeight" style="width:70px"/></td>
				<td><input name="addMoney" #if(!$!isSaved)readOnly#end value="$!line.addMoney" style="width:70px"/></td>
				<td><input name="addGoldWeight" #if(!$!isSaved)readOnly#end value="$!line.addGoldWeight" style="width:70px"/></td>
				<td><input name="addGoldMoney" #if(!$!isSaved)readOnly#end value="$!line.addGoldMoney" style="width:70px"/></td>
				<td><input name="repairCharge" #if(!$!isSaved)readOnly#end value="$!line.repairCharge" style="width:70px" dataType="Require" msg="不能为空"/></td>
				<td><input name="repairMoney" #if(!$!isSaved)readOnly#end value="$!line.repairMoney" onblur="changeValues()" style="width:70px" dataType="Require" msg="不能为空"/></td>
				<td><input type='button' value='删除' #if(!$isSaved)disabled#end style='width:60px;' onclick='deleteLine(this, "$!{line.lineid}")'/>
					<input type='hidden' name='lineid' value = "$!line.lineid" />
					<input type='hidden' name='dotype_old' value = "$!line.dotype" />
					<input type='hidden' name='itemClassId_old' value = "$!line.itemClassId" />
					<input type='hidden' name='ornaClassId_old' value = "$!line.ornaClassId" />
					<input type='hidden' name='qualityId_old' value = "$!line.qualityId" />
				</td>
			</tr>
		#end
    	</tbody>
    </table>

</form>

<script>
var isSaved = $!isSaved;
jQuery(function(){
	initCalendar("dodate");
	initFun();
	jQuery("#deleteIds").val("");
	checkReview();
	changeSeq("tbl");
});

function showVendorWin(){
	selectVendor(function(idArr, nameArr){
		jQuery("#vendorId").val(idArr.join(','));
		jQuery("#vendorName").val(nameArr.join(','));
	}, null, null, false, jQuery("#vendorId").val());
}
</script>