#set($jsfiles = ["$StringUtil.getContextPath()/script/mclon/calendar/calendar.js"])
#set($cssfiles = ["$StringUtil.getContextPath()/js/move/moveBill_print.css"])
<form id='frm' action="outVendor.vm" method="post">
	#set($pubSale = $form.head)
	#set($pubSale = $form.head)
	#set($enablePrint = false)
	#set($modelCode = '08040602')
	<input type="hidden" id="user_action" name="user_action" value=""/>
	<input type="hidden" id="headId" name="headId" value="$!{pubSale.headId}"/>
    <table class="title">
    	<tr><td>委外发料打印详细页</td></tr>
    </table>
    <table class="control">
    	<tr><td align="center">
				<b>委外发料单<b>
		</td></tr>
    </table>
    <table style="BORDER-COLLAPSE: collapse" borderColor="#000000" height="40" cellPadding="1" width="100%" border="1" >
    	<tr>
			<td class='black_td' style='width:35%;' nowrap><b>送石方：</b>$!BdCommon.getOrgName($pubSale.orgId)</td>	
			<td class='black_td' nowrap><b>收石方：</b>$!BdCommon.getVendorName($!pubSale.vendorId)</td>	
		</tr>
		<tr>
			<td class='black_td' nowrap><b>日期：</b>$!pubSale.doDate</td>	
			<td class='black_td' nowrap><b>委外发料单号：</b>$!pubSale.billno</td>
		</tr>
			<td class='black_td' nowrap><b>采购订单号：</b>$!pubSale.purBillNo</td>	
			<td class='black_td' nowrap><b>备注：</b>$!pubSale.memo</td>	
        <tr>
		</tr>
    </table>
	<table style="BORDER-COLLAPSE: collapse" borderColor="#000000" height="40" cellPadding="1" width="100%" border="1">
    	<tbody id="tbl">
			<tr>
        		<td class='black_td' nowrap>序号</td>
                <td class='black_td' nowrap>分析范围</td>
        		<td class='black_td' nowrap>饰品编码</td>
				<td class='black_td' nowrap>现有粒数</td>
				<td class='black_td' nowrap>重量</td>
				<td class='black_td' nowrap>品质</td>
				<td class='black_td' nowrap>形状</td>
				<td class='black_td' nowrap>颜色</td>
				<td class='black_td' nowrap>成色</td>
        		<td class='black_td' nowrap>HRD证书</td>
        		<td class='black_td' nowrap>IGI证书</td>
        		<td class='black_td' nowrap>GIA证书</td>
        		<td class='black_td' nowrap>备  注</td>
            </tr>
			#if($pubSale.status == "8")
				#foreach($map in $form.printListNo)
        			<tr>
						<td class='black_td' nowrap>$!velocityCounter</td>
        				<td class='black_td' nowrap>$!map.alaysisId</td>
                        <td class='black_td' nowrap>$!map.ornaCode</td>
        				<td class='black_td1' nowrap>$!map.nowQty</td>
        				<td class='black_td' nowrap>$!map.allQty
							<input type='hidden' name="#allQty"  value="$!map.allQty"></td></td>
        				<td class='black_td' nowrap>$!DictUtil.getValue('diacolorgrade', $!map.colorGradeGradeId)$!DictUtil.getValue('diaclean', $!map.cleanGradeId)</td>
        				<td class='black_td' nowrap>$!DictUtil.getValue('diashape', $!map.mainShapeId)</td>
        				<td class='black_td' nowrap>$!DictUtil.getValue('diacolor', $!map.colorId)</td>
						<td class='black_td' nowrap>$!BdCommon.getQualityName($!map.qualityId)</td>
        				<td class='black_td' nowrap>$!map.hrdCert</td>
        				<td class='black_td' nowrap>$!map.igiCert</td>
        				<td class='black_td' nowrap>$!map.giaCert</td>
        				<td class='black_td' nowrap></td>
        			</tr>
        		#end
			#else
				#foreach($map in $form.printList)
        			<tr>
						<td class='black_td' nowrap class='black_td' nowrap>$!velocityCounter</td>
        				<td class='black_td' nowrap>$!map.alaysisId</td>
                        <td class='black_td' nowrap>$!map.ornaCode</td>
        				<td class='black_td1' nowrap>$!map.nowQty</td>
        				<td class='black_td' nowrap>$!map.allQty
							<input type='hidden' name="#allQty"  value="$!map.allQty"></td>
        				<td class='black_td' nowrap>$!DictUtil.getValue('gradelevel', $!map.colorGradeGradeId)$!DictUtil.getValue('gradelevel', $!map.cleanGradeId)</td>
        				<td class='black_td' nowrap>$!DictUtil.getValue('diashape', $!map.mainShapeId)</td>
        				<td class='black_td' nowrap>$!DictUtil.getValue('diacolor', $!map.colorId)</td>
						<td class='black_td' nowrap>$!BdCommon.getQualityName($!map.qualityId)</td>
        				<td class='black_td' nowrap>$!map.hrdCert</td>
        				<td class='black_td' nowrap>$!map.igiCert</td>
        				<td class='black_td' nowrap>$!map.giaCert</td>
        				<td class='black_td' nowrap></td>
        			</tr>
        		#end
			#end
    		<tr>
        		<td class='black_td' nowrap colspan="3"><b>合计：</b></td>
    			<td class='black_td' nowrap align="center">$!{pubSale.sumGrains}</td>
                <td class='black_td' nowrap><label id="showMasage"/></td>
    			<td class='black_td' nowrap colspan="8"></td>
            </tr>
    		<tr>
    			<td class='black_td' nowrap colspan="3"><b>制单人：</b>$!BdCommon.getUserName($!{pubSale.createId})</td>
    			<td class='black_td' nowrap colspan="5"><b>送石人：</b></td>	
    			<td class='black_td' nowrap colspan="5"><b>收石人：</b></td>	
    		</tr>
    	</tbody>
    </table>
</form>
<script>

jQuery(function(){
	jQuery("#btnToList").click(function(){
		window.location = "outVendor.vm?user_action=toEntrustoutList";
	});
	var sumWeight=0;
	for(var i=0;i<$("tbl").rows.length-3;i++){
		sumWeight+=Number($n("#allQty")[i].value||0);
	}
	jQuery("#showMasage").text(parseFloat(sumWeight).toFixed(3));
	
	window.print();
	
})

</script>