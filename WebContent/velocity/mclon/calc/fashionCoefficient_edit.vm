#set($jsfiles = ["$StringUtil.getContextPath()/dwr/interface/FashionCoefficientDwr.js"])

<form id='frm' action="" method="post">
	<input type="hidden" id="fashId" value="$!{form.sc.fashId}"/>
    <table class="title">
    	<tr><td>黄金系数</td></tr>
    </table>
    <table class="control">
    	<tr><td>
				<input type='button' value='保存' class='btn' id='btnSave' $RightUtil.able($session, '08061102','1')>
				<input type='button' value='返回列表' class='btn' id="btnToList">
		</td></tr>
    </table>
    <table class='content'>
		<tr>
			<td class='body1'>大类</td>	
			<td class='body2'>
				<select id="itemClassId" dataType="Require" msg="不能为空" >$StringUtil.emptyOption()</select>$StringUtil.star()
			</td>
		</tr>
    	<tr>
			<td class='body1'>系数</td><td class='body2'><input type='text' id='coefficient' dataType="Require" msg="不能为空" value="$!{form.sc.coefficient}">$StringUtil.star()</td>
		</tr>
    	<tr>
			<td class='body1'>启始总成本</td><td class='body2'><input type='text' id='priceStr' dataType="Require" msg="不能为空" value="$!{form.sc.priceStr}">$StringUtil.star()</td>
		</tr>
    	<tr>
			<td class='body1'>截止总成本</td><td class='body2'><input type='text' id='priceEnd' dataType="Require" msg="不能为空" value="$!{form.sc.priceEnd}">$StringUtil.star()</td>
		</tr>
		<tr>
			<td class='body1'>备注</td><td class='body2'><input type='text' id='memo' value="$!{form.sc.memo}"></td>
		</tr>
    	<tr>
			<td class='body1'>状态</td><td class='body2'>
				<input type='hidden' id='status' value="$!{form.sc.status}">
				<input type='text' id='statusName' readonly value="$!DictUtil.getValue('status',$!{form.sc.status})"></td>
		</tr>
    </table>
</form>

<script>
function setPageContent(){
	BdCommonDwr.getAllItemClassForSlt(function(data){
		addOptions("itemClassId", data, null, null, true, true);
	});
	jQuery("#statusName").val("保存");
	jQuery("#status").val("1");
}

jQuery(function(){
	jQuery("#btnSave").click(function(){
    	saveFashionCoefficient();
	});
	jQuery("#btnToList").click(function(){
		window.location = "fashionCoefficient.vm";
	});
	if("$!form.sc.fashId"){
		setValues();
	}else{
		setPageContent();
	}
});
function setValues(){
	BdCommonDwr.getAllItemClassForSlt(function(data){
		addOptions("itemClassId", data, null, null, true, true,"$!{form.sc.itemClassId}");
	});
}

/**
 * 保存
 * @returns {Boolean}
 */
function saveFashionCoefficient(){
	if(!isDecimal(jQuery("#priceStr").val())){
		alert('启始重量必须为数字');
		return false;
	}else if(!isDecimal(jQuery("#priceEnd").val())){
		alert('截止重量必须为数字');
		return false;
	}else if(parseFloat(jQuery("#priceStr").val())>=jQuery("#priceEnd").val()){
		alert('截止重量必须大于启始重量');
		return false;
	}else if(!isDecimal(jQuery("#coefficient").val())){
		alert('系数必须为数字');
		return false;
	}
	if(Validator.Validate($("frm"),3)){
		confirm("确定保存?", function(){
    		var headObj = {fashId:jQuery("#fashId").val(),
    					   itemClassId:jQuery("#itemClassId").val(),
    					   coefficient:jQuery("#coefficient").val(),
    					   memo:jQuery("#memo").val(),
    					   status:jQuery("#status").val(),
    					   priceStr:jQuery("#priceStr").val(),
    					   priceEnd:jQuery("#priceEnd").val()
    		};
    		FashionCoefficientDwr.saveOrUpdateFashionCoefficient(headObj, function(data){
    			var m = data.split("_");
    			if(m[0]=="2"){
    				alert(m[1]);
    			}else{
    				alert(m[1], function(){
    					window.location = "fashionCoefficient.vm";
    				});
    			}
    		});
    	});
	}
	
}
</script>