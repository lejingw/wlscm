#set($jsfiles = ["$StringUtil.getContextPath()/dwr/interface/BdCommonDwr.js", 
                "$StringUtil.getContextPath()/dwr/interface/JmSaleDwr.js?t=201207171130.js", 
                "$StringUtil.getContextPath()/js/stock/jmSale.js?t=201209111130.js"])
	
<form id='frm' action="jmSale.vm" method="post">
	#set($jmSaleHead = $form.jmSaleHead)
	#set($lines = $form.lines)
	
	#if($StringUtil.isBlank($!jmSaleHead.billno))
		#set($billno = "自动生成")
		#set($orgId = $StringUtil.getOrgId($session))
		#set($dodate = $DateUtil.getCurrentDate10())
		#set($statusName = "保存") 
		#set($status = "1")
	#else
		#set($billno = $jmSaleHead.billno)
		#set($orgId = $jmSaleHead.orgId)
		#set($dodate = $jmSaleHead.dodate)
		#set($statusName = $!DictUtil.getValue('status', $!{jmSaleHead.status}))
		#set($status = $!{jmSaleHead.status})
	#end
	
	#set($enableSave = false)
	#set($enableCheck = false)
	#set($enableClose = false)
	#set($enablePrint = false)
	#set($isSaved = false)
	#if($StringUtil.isNotBlank($status))
		#if($status == "1")
			#set($enableSave = true)
			#set($isSaved = true)
			#set($enableCheck = true)
		#elseif($status == "5")##审批完成
			#set($enableClose = true)
			#set($enablePrint = true)
			#set($isSaved = false)
		#elseif($status == "8")##关闭状态
			#set($enablePrint = true)
		#end
	#end
	#if($jmSaleHead)
		#set($disable = true)
	#end
	<input type="hidden" id="user_action" name="user_action" value=""/>
	<input type="hidden" id="billid" name="billid" value="$!{jmSaleHead.billid}"/>
	<input type="hidden" id="billCode" name="billCode" value="TL"/>
	<input type='hidden' id="deleteIds" name='deleteIds'  value=""/>
    <table class="title">
    	<tr><td>代销修改详细页</td></tr>
    </table>
    <table class="control">
    	<tr><td>
				<input type='button' value='保存' #if(!$enableSave)disabled#end class='btn' id='btnSave' $RightUtil.able($session, '08031102','1')>
				<input type='button' value='审核' #if(!$enableCheck)disabled#end class='btn' id='btnCheck' $RightUtil.able($session, '08031102','2')>
				##<input type='button' value='关闭'  #if(!$enableClose)disabled#end class='btn' id='btnClose' $RightUtil.able($session, '08031102','3')>
				<input type='button' value='返回列表' class='btn' id="btnToList">
				<input type='button' value='打印' class='btn' id='btnPrint' onclick="window.print()" $RightUtil.able($session, '08031102','4')>
		</td></tr>
    </table>
    <table class='content'>
    	<tr>
			<td class='body1'>单据编号：</td>
			<td class='body2'>
				<input type='text' id="billno" name='billno' readonly value="$!billno">
			</td>
			<td class='body1'>单据日期：</td>
			<td class='body2'>
				<input type='text' id="dodate" name='dodate' readonly #if(!$isSaved)disabled#end value="$!{dodate}" dataType="Require" msg="不能为空">
			</td>
			<td class='body1'>组织:</td>	
			<td class='body2'>
				<input type='hidden' id="orgId" name='orgId' value="$!{orgId}">
				<input type='text' id="orgName" name='orgName'  value="$!BdCommon.getOrgName($orgId)" readonly  dataType="Require" msg="不能为空" >
			</td>
			<td class='body1'>单据状态：</td>	
			<td class='body2'>
				<input type='text' id="status" name='status' readonly value="$!statusName">
			</td>
		</tr>
		<tr>
			<td class='body1'>仓库：</td>
			<td class='body2'>
				<select id="stock_id" name="stock_id" #if($procChange)disabled#end  dataType="Require" value="$jmSaleHead.stockId" msg="不能为空" >
					$StringUtil.emptyOption()
				</select>
				$StringUtil.star()
			</td>
			<td class='body1'>件数合计：</td>	
			<td class='body2'>
				<input type='text' id="sumCount" readonly name='sumCount' value="$!{jmSaleHead.sumCount}" >
			</td>
			<td class='body1'>重量合计：</td>
			<td class='body2'>
				<input type='text' id="sumWeight" readonly name='sumWeight' value="$!{jmSaleHead.sumWeight}" >
			</td>
			<td class='body1'>粒数合计：</td>	
			<td class='body2'>
				<input type='text' id="sumGrains" name='sumGrains' readonly value="$!{jmSaleHead.sumGrains}" >
			</td>
		</tr>
		<tr>
			<td class='body1'>金额合计：</td>	
			<td class='body2'>
				<input type='text' id="sumMoney" name='sumMoney' readonly value="$!{jmSaleHead.sumMoney}" >
			</td>
			<td class='body1'>特价金额合计：</td>	
			<td class='body2'>
				<input type='text' id="sumJmmoney" name='sumJmmoney' value="$!{jmSaleHead.sumJmmoney}" >
			</td>
			<td class='body1'></td>	
			<td class='body2'></td>
			<td class='body1'></td>	
			<td class='body2'></td>
		</tr>
		<tr>
			<td class='body1'>备注：</td>
			<td class='body2' colspan="7">
				<input type="text" id="memo" name="memo" #if(!$isSaved)readonly#end style="width:90%;" value="$!{jmSaleHead.memo}"/>
			</td>
		</tr>
		<tr>
			<td class='body1'>条码：</td>
			<td class='body2'>
				<input type='text' id="barCode_in" name='barCode_in' #if(!$isSaved)disabled#end  value="">
			</td>
			<td class='body1'>编码：</td>
			<td class='body2'>
				<input type='text' id="ornaCode_in" name='ornaCode_in'  #if(!$isSaved)disabled#end value="">
			</td>
			<td class='body1'>折扣：</td>	
			<td class='body2'><input type='text' id="discount" value="" onblur="checkDiscount()"></td>
            <td class='body2' colspan="2"></td>
		</tr>
    </table>
	
	<table class='list'>
    	<thead>
			<tr>
				<th></th>
				<th>饰品编码</th>
                <th>饰品名称</th>
    			<th>大类</th>
				<th>小类</th>
    			<th>款式大类</th>
    			<th>款式中类</th>
    			<th>款式小类</th>
    			<th>款式</th>
    			<th>分析范围</th>
    			<th>计量单位</th>
    			<th>现有量</th>
    			<th>总重量</th>
    			<th>粒数</th>
    			<th>主石重量</th>
				<th>配石重量</th>
				<th>是否多粒</th>
				<th>是否双标签</th>
				<th>网店金额</th>
				<th>是否代销</th>
                <th>折扣</th>
                <th>加盟销售价</th>
				<th width='60px'></th>
            </tr>
        </thead>
        <tbody id="tbl">
		#foreach($line in $lines)
			<tr>
				<td></td>
				<td>$!line.ornaCode</td>
				<td>$!line.ornaDsc</td>
				<td>$!line.itemClassName</td>
				<td>$!line.ornaClassName</td>
				<td>$!line.styleitemclassName</td>
				<td>$!line.stylemiddleclassName</td>
				<td>$!line.styleornaclassName</td>
				<td>$!HtmlUtil.printStyle($!line.styleId, $!line.styleName, $!line.bigGraph)</td>
				<td>$!line.alaysisName</td>
				<td>$!line.unitName</td>
				<td>$!line.nowQty</td>
				<td>$!line.allQty</td>
				<td>$!line.grains</td>
				<td>$!line.mainWeight</td>
				<td>$!line.partWeight</td>
				<td>$!line.isMutiPartName</td>
				<td>$!line.isDblLabelName</td>
				<td>$!line.posMoney</td>
				<td>$!line.isPsaleName</td>
				<td><input type='text' name='rebate' value = "$!StringUtil.formatDouble($!line.rebate, 4)"  readOnly style="width:50px" /></td>
				<td><input type='text' name='jmsaleMoney' value = "$!line.jmsaleMoney" onblur="changeValues()" #if(!$isSaved)readOnly#end style="width:70px" dataType="Require" msg="不能为空"/></td>
				<td><input type='button' value='删除' #if(!$isSaved)disabled#end style='width:60px;' onclick='deleteLine(this, "$!{line.lineid}")'/>
					 <input type='hidden' name='ornaCode'        	value = "$!line.ornaCode"/> 
					 <input type='hidden' name='ornaBarcode'      	value = "$!line.ornaBarcode"/> 
					 <input type='hidden' name='ornaDsc'         	value = "$!line.ornaDsc"/>
					 <input type='hidden' name='itemClassId'     	value = "$!line.itemClassId"/> 
					 <input type='hidden' name='ornaClassId'      	value = "$!line.ornaClassId"/> 
					 <input type='hidden' name='styleitemclass'     value = "$!line.styleitemclass"/> 
					 <input type='hidden' name='stylemiddleclass'   value = "$!line.stylemiddleclass"/> 
					 <input type='hidden' name='styleornaclass'     value = "$!line.styleornaclass"/> 
					 <input type='hidden' name='styleId'       		value = "$!line.styleId"/> 
					 <input type='hidden' name='alaysisId'          value = "$!line.alaysisId"/> 
					 <input type='hidden' name='unitId'         	value = "$!line.unitId"/> 
					 <input type='hidden' name='nowQty'          	value = "$!line.nowQty" />
					 <input type='hidden' name='allQty'          	value = "$!line.allQty" />
					 <input type='hidden' name='grains' 			value = "$!line.grains"/>
					 <input type='hidden' name='mainWeight' 		value = "$!line.mainWeight"/>
					 <input type='hidden' name='partWeight' 		value = "$!line.partWeight"/>
					 <input type='hidden' name='isMutiPart' 		value = "$!line.isMutiPart"/>
					 <input type='hidden' name='isDblLabel' 		value = "$!line.isDblLabel"/>
					 <input type='hidden' name='posMoney' 			value = "$!line.posMoney"/>
					 <input type='hidden' name='isPsale' 			value = "$!line.isPsale"/>
					<input type='hidden' name='lineid' 				value = "$!line.lineid" />
				</td>
			</tr>
		#end
    	</tbody>
    </table>
</form>
<script>

jQuery(function(){
	altRowCSS('tbl');
	initCalendar("dodate");
	
	setEnterKey("ornaCode_in", loadOldItemByOrnaCode);	
	setEnterKey("barCode_in", loadOldItemByBarCode);
	DictDwr.getDictsForSlt("invcode", function(data){
		addOptions("stock_id",  data, null, null, true, true, "$!jmSaleHead.stockId");
	});
	
	jQuery("#deleteIds").val("");
	jQuery("#btnSave").click(saveform);
	jQuery("#btnClose").click(closeBill);
	jQuery("#btnCheck").click(checkBill);
	jQuery("#btnToList").click(function(){
		window.location = "jmSale.vm";
	});
	enableCheck();
	checkReview();
	changeSeq("tbl");
})

</script>