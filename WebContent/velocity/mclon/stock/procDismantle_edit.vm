#set($cssfiles = ["$StringUtil.getContextPath()/script/mclon/calendar/calendar.css"])
#set($jsfiles = ["$StringUtil.getContextPath()/script/mclon/calendar/calendar.js",
                "$StringUtil.getContextPath()/dwr/interface/BaseChangeDwr.js",
                "$StringUtil.getContextPath()/dwr/interface/ProcDismantleDwr.js",
				"$StringUtil.getContextPath()/js/stock/baseChange.js?t=201203311650.js",
                "$StringUtil.getContextPath()/js/stock/procDismantle.js?t=201203211650.js"])
	
<form id='frm' action="procDismantle.vm" method="post">
	#set($procChange = $form.procChangeHead)
	#set($oldLines = $form.oldLines)
	#set($newLines = $form.newLines)
	
	#if($StringUtil.isBlank($!procChange.billno))
		#set($billno = "自动生成")
		#set($orgId = $StringUtil.getOrgId($session))
		#set($dodate = $DateUtil.getCurrentDate10())
		#set($statusName = "保存")
		#set($status = "1")
	#else
		#set($billno = $procChange.billno)
		#set($orgId = $procChange.orgId)
		#set($dodate = $procChange.dodate)
		#set($statusName = $!DictUtil.getValue('status', $!{procChange.status}))
		#set($status = $!{procChange.status})
	#end
	
	#set($enableAdd = false)
	#set($enableSave = false)
	#set($enableCheck = false)
	#set($enableClose = false)
	#set($enableDelete = false)
	#set($enablePrint = false)
	#set($isSaved = false)
	#set($isHandover = false)
	#if($StringUtil.isNotBlank($status))
		#if($status == "1")
			#set($enableAdd = true)
			#set($enableSave = true)
			#set($isSaved = true)
			#set($enableCheck = true)
		#elseif($status == "5")##审批完成
			#set($enableClose = true)
			#set($enablePrint = true)
			#set($isHandover = true)
		#elseif($status == "8")##关闭状态
			#set($enablePrint = true)
			#set($isHandover = true)
		#elseif($status == "9")##关闭状态
			#set($enablePrint = true)
			#set($enableDelete = true)
			#set($isHandover = true)
		#end
	#end
	<input type="hidden" id="user_action" name="user_action" value="toEdit"/>
	<input type="hidden" id="billid" name="billid" value="$!{procChange.billid}"/>
	<input type="hidden" id="billCode" name="billCode" value="CS"/>
    <table class="title">
    	<tr><td>拆石详情页</td></tr>
    </table>
    <table class="control">
    	<tr><td>
				##<input type='button' value='增行' #if(!$enableAdd)disabled#end class='btn' id='btnAddNewMater'>
				<input type='button' value='保存' #if(!$enableSave)disabled#end class='btn' id='btnSave' $RightUtil.able($session, '08030702','1')>
				<input type='button' value='审核' #if(!$enableCheck)disabled#end class='btn' id='btnCheck' $RightUtil.able($session, '08030702','2')>
				##<input type='button' value='关闭' #if(!$enableClose)disabled#end class='btn' id='btnClose' $RightUtil.able($session, '08030702','3')>
				<input type='button' value='作废' style="display:none;" class='btn' id='btnDelete' $RightUtil.able($session, '08030702','4')>
				<input type='button' value='交接单' style="display:#if(!$isHandover)none#end;" class='btn' id='btnHandover' $RightUtil.able($session, '08030702','5')>
				<input type='button' value='返回列表' class='btn' id="btnToList">
				<input type='button' value='打印' class='btn' id='btnPrint' onclick="window.print()" $RightUtil.able($session, '08030702','6')>
				
		</td></tr>
    </table>
    <table class='content'>
    	<tr>
			<td class='body1'>单据编号：</td>
			<td class='body2'>
				<input type='text' id="billno" name='billno' readonly value="$!billno">
			</td>
			<td class='body1'>单据日期：</td>
			<td class='body2'>
				<input type='text' id="dodate" name='dodate' readonly #if(!$isSaved)disabled#end value="$!{dodate}" dataType="Require" msg="不能为空">
			</td>
			<td class='body1'>组织:</td>	
			<td class='body2'>
				<input type='hidden' id="orgId" name='orgId' value="$!{orgId}">
				<input type='text' id="orgName" name='orgName'  value="$!BdCommon.getOrgName($orgId)" readonly  dataType="Require" msg="不能为空" >
			</td>
			<td class='body1'>单据状态：</td>	
			<td class='body2'>
				<input type='text' id="status" name='status' readonly value="$!statusName">
			</td>
		</tr>
		<tr>
			<td class='body1'>件数合计：</td>	
			<td class='body2'>
				<input type='text' id="sumCount" readonly name='sumCount' value="$!{procChange.sumCount}">
			</td>
			<td class='body1'>重量合计：</td>
			<td class='body2'>
				<input type='text' id="sumWeight" readonly name='sumWeight' value="$!{procChange.sumWeight}">
			</td>
			<td class='body1'>粒数合计：</td>	
			<td class='body2'>
				<input type='text' id="sumGrains" name='sumGrains' readonly value="$!{procChange.sumGrains}">
			</td>
			<td class='body1'>金额合计：</td>
			<td class='body2'>
				<input type='text' id="sumMoney" name='sumMoney' readonly value="$!{procChange.sumMoney}">
			</td>
		</tr>
		<tr>
			<td class='body1'>成本合计：</td>
			<td class='body2'>
				<input type='text' id="sumCost" name='sumCost' readonly value="$!{procChange.sumCost}">
			</td>
			<td class='body1'>仓库：</td>
			<td class='body2'>
				<select id="stock_id" name="stock_id" #if($procChange)disabled#end  dataType="Require" value="$procChange.stockId" msg="不能为空" >
					$StringUtil.emptyOption()
				</select>
				$StringUtil.star()
			</td>
			<td class='body1'>备注：</td>
			<td class='body2' colspan="3">
				<input type="text" id="memo" name="memo" #if(!$isSaved)readonly#end style="width:90%;" value="$!{procChange.memo}"/>
			</td>
		</tr>
		<tr>
			<td class='body1'>条码：</td>
			<td class='body2'>
				<input type='text' id="barCode_in" name='barCode_in' #if(!$isSaved)disabled#end value="">
			</td>
			<td class='body1'>编码：</td>
			<td class='body2'>
				<input type='text' id="ornaCode_in" name='ornaCode_in' #if(!$isSaved)disabled#end value="">
			</td>
			<td class='body2' colspan="4"></td>
		</tr>
    </table>
	<input type='hidden' id="deleteOldIds" name='deleteOldIds'  value=""/>
	
	<table class='list'>
    	<thead>
			<tr>
				<th></th>
				<th>大类</th>
				<th>小类</th>
				<th>款式</th>
                <th>分析范围</th>
        		<th>饰品编码</th>
        		<th>饰品名称</th>
				<th>计量单位</th>
				<th>现有量</th>
				<th>总重量</th>
				<th>粒数</th>
				<th>销售金额</th>
				<th>成本</th>
				<th>主石重量</th>
        		<th>配石重量</th>
				<th width='60px'></th>
            </tr>
        </thead>
        <tbody id="tbl_old_mater">
		#foreach($oldLine in $oldLines)
			<tr>
				<td></td>
				<td>$!oldLine.itemClassName</td>
				<td>$!oldLine.ornaClassName</td>
				<td>$!HtmlUtil.printStyle($!oldLine.styleId, $!oldLine.styleName, $!oldLine.bigGraph)</td>
				<td>$!oldLine.alaysisName</td>
				<td>$!oldLine.ornaCode</td>
				<td>$!oldLine.ornaDsc</td>
				<td>$!oldLine.unitName</td>
                <td>$!oldLine.nowQty</td>
				<td>$!oldLine.allQty</td>
				<td>$!oldLine.grains</td>
				<td>$!oldLine.posMoney</td>
				<td>$!oldLine.posCost</td>
				<td>$!oldLine.mainWeight</td>
				<td>$!oldLine.partWeight</td>
				<td><input type='button' value='删除' #if(!$isSaved)disabled#end style='width:60px;' onclick='deleteMater(this, "$!{oldLine.ornaCode}")'/>
    				<input type='hidden' name='oldRowId' value="$!oldLine.rowId" />
					<input type='hidden' name='itemClassId' value="$!oldLine.itemClassId" />
    				<input type='hidden' name='ornaClassId' value="$!oldLine.ornaClassId" />
    				<input type='hidden' name='styleId' value="$!oldLine.styleId" /> 
    				<input type='hidden' name='alaysisId' value="$!oldLine.alaysisId" />
    				<input type='hidden' name='alaysisName' value="$!oldLine.alaysisName" />
    				<input type='hidden' name='ornaCode' value="$!oldLine.ornaCode" /> 
    				<input type='hidden' name='ornaDsc' value="$!oldLine.ornaDsc" /> 
    				<input type='hidden' name='ornaBarcode' value="$!oldLine.ornaBarcode" />
    				<input type='hidden' name='saleUnitId' value="$!oldLine.unitId" /> 
    				<input type='hidden' name='nowQty' value="$!oldLine.nowQty" /> 
    				<input type='hidden' name='allQty' value="$!oldLine.allQty" /> 
    				<input type='hidden' name='stoneNowNum' value="$!oldLine.grains" />
    				<input type='hidden' name='posAmount' value="$!oldLine.posMoney" /> 
    				<input type='hidden' name='mainWeight' value="$!oldLine.mainWeight" /> 
    				<input type='hidden' name='partWeight' value="$!oldLine.partWeight" />
    				<input type='hidden' name='isMutiPart' value="$!oldLine.isMutiPart" />
    				<input type='hidden' name='isDblLabel' value="$!oldLine.isDblLabel" />
    				<input type='hidden' name='isConsign' value="$!oldLine.isPsale" />
					<input type='hidden' name='stockId' value="$!oldLine.stockId" />
					<input type='hidden' name='posCost' value="$!oldLine.posCost" />
    				<input type='hidden' name='oldLineid' value="$!oldLine.lineid" />					
				</td>
			</tr>
		#end
    	</tbody>
    </table>
	
</form>
<script>

jQuery(function(){
	initCalendar("dodate");
	jQuery("#deleteOldIds").val("");
	setEnterKey("ornaCode_in", loadOldItemByOrnaCode);
	setEnterKey("barCode_in", loadOldItemByBarCode);
	//jQuery("#barCode").change(loadOldItemByBarCode);
	DictDwr.getDictsForSlt("invcode", function(data){
		addOptions("stock_id",  data, null, null, true, true, "$!procChange.stockId");
	});
	jQuery("#btnSave").click(saveform);
	//jQuery("#btnClose").click(closeBill);
	jQuery("#btnCheck").click(checkBill);
	jQuery("#btnDelete").click(deleteBill);
	jQuery("#btnHandover").click(showHandover);
	jQuery("#btnToList").click(function(){
		window.location = "procDismantle.vm";
	});
	checkReview();
	altRowCSS("tbl_old_mater");
	changeSeq("tbl_old_mater");
})

</script>