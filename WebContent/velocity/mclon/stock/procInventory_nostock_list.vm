#set($cssfiles = ["$StringUtil.getContextPath()/script/mclon/calendar/calendar.css"])
#set($jsfiles = ["$StringUtil.getContextPath()/script/mclon/calendar/calendar.js"])

<form id="frm" name="frm" method="post" action="procInventory.vm">
    <table class="title">
    	<tr><td>盘点单#if($!form.message)[<font color='red'>$!form.message</font>]#end</td></tr>
    </table>
	<table class='content'>
		#set($cond = $form.condition)
		#set($itemClassId = $!cond.get('itemClassId'))
		#set($ornaClassId = $!cond.get('ornaClassId'))
		#set($groups = $!cond.get('groups'))
		#set($orgId = $!cond.get('orgId'))
		#set($stockId = $!cond.get('stockId'))
		<tr>
			<td class="body1">大类</td>
			<td class="body2">
				<select id="itemClassId" name="itemClassId"  >$StringUtil.emptyOption()</select>
			</td>
			<td class="body1">小类</td>
			<td class="body2">
				<select id="ornaClassId" name="ornaClassId" >$StringUtil.emptyOption()</select>
			</td>
			<td class="body1">仓库</td>
			<td class="body2">
				<select id="stockId" name="stockId" >$StringUtil.emptyOption()</select>
			</td>
			<td class="body1">柜组</td>
			<td class="body2">
				<select id="groups" name="groups" >$StringUtil.emptyOption()</select>
			</td>
			<td class="body1">
				<input type='hidden' name="user_action" value='doNoStockList' />
				<input type="hidden" name="orgId" value="$!orgId"/>
				<input type='button' value='查询' class='btn' id='btnSearch'>
			</td>
        </tr>
    </table>
    <table class='list'>
    	<thead>
			<tr>
                ##<th width='20px'><input type='checkbox' id='chkall'/></th>
                <th>大类</th>
				<th>小类</th>
				<th>款式</th>
                <th>分析范围</th>
        		<th>饰品编码</th>
				<th>饰品条码</th>
        		<th>饰品名称</th>
				<th>计量单位</th>
				<th>现有量</th>
				<th>总重量</th>
				<th>粒数</th>
				<th>销售金额</th>
				<th>主石重量</th>
        		<th>配石重量</th>
				<th>柜组</th>
				<th>备注</th>
            </tr>
        </thead>
        <tbody id="tbl">
		#foreach($map in $form.pager.pageData)
			<tr>
				##<td><input type='checkbox' name='chk'/></td>
				<td>$!map.itemClassName</td>
				<td>$!map.ornaClassName</td>
				<td><a href='javascript:viewStyle("$!map.styleId")'>$!map.styleName</a></td>
				<td>$!map.alaysisName</td>
				<td>$!map.ornaCode</td>
				<td>$!map.ornaBarcode</td>
				<td>$!map.ornaDsc</td>
				<td>$!map.saleUnitName</td>
                <td>$!map.nowQty</td>
				<td>$!map.allQty</td>
				<td>$!map.stoneNowNum</td>
				<td>$!map.posAmount</td>
				<td>$!map.mainWeight</td>
				<td>$!map.partWeight</td>
				<td>$!DictUtil.getValue('group', $!map.groups)</td>
                <td></td>
			</tr>
		#end
    	</tbody>
    </table>
<script>
createPagingToolbar('frm', $!form.pager.start, $!form.pager.limit, $!form.pager.totalCount);
</script>
</form>
<script>

function changeItemClass(ornaValue){
	BdCommonDwr.getOrnaClassByItemClassIdForSlt(jQuery("#itemClassId").val(), function(data){
		addOptions("ornaClassId", data, null, null, true, true, ornaValue);
	});
}
function setValues(){
	BdCommonDwr.getAllItemClassForSlt(function(data){
		addOptions("itemClassId", data, null, null, true, true, "$!itemClassId");
    	changeItemClass("$!ornaClassId");
	});
	DictDwr.getDictsForSlt("invcode", function(data){
		addOptions("stockId",  data, null, null, true, true, "$!stockId");
	});
}

function setGroups(groupVal){
	DictDwr.getDictsForSlt('group', function(data){
		addOptions("groups", data, null, null, true, true, groupVal);
	});
}
jQuery(function(){
	jQuery("#itemClassId").change(changeItemClass);
	
	setGroups("$!DictUtil.getValue('group', $!groups)");
	
	setValues();
})


jQuery(function(){
	checkAll("chkall",'chk', true)
	altRowCSS('tbl');// 为列表添加换行样式
	
	jQuery("#btnSearch").click(function(){
		jQuery("#frm").submit();
	});
});

</script>
