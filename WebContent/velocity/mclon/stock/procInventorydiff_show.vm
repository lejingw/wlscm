#set($cssfiles = ["$StringUtil.getContextPath()/script/mclon/calendar/calendar.css"])
#set($jsfiles = ["$StringUtil.getContextPath()/script/mclon/calendar/calendar.js",
                "$StringUtil.getContextPath()/dwr/interface/InventoryDwr.js", 
                "$StringUtil.getContextPath()/js/stock/inventory.js?t=201208171703.js"])
	
<form id='frm' action="procInventory.vm" method="post">
	#set($inventoryDiffHead = $form.procInventoryDiffhead)
	#set($lines = $form.pager.pageData)
	
	<input type="hidden" id="user_action" name="user_action" value="toShowDiff"/>
	<input type="hidden" id="billid" name="billid" value="$!{inventoryDiffHead.billid}"/>
    <table class="title">
    	<tr><td>差异单详情查看</td></tr>
    </table>
    <table class="control">
    	<tr><td>
				<input type='button' value='打印' class='btn' id='btnPrint' onclick="window.print()" $RightUtil.able($session, '08030904','2')/>
				<input type='button' value='返回列表' class='btn' id="btnToList">
		</td></tr>
    </table>
    <table class='content'>
		#if($StringUtil.isBlank($!inventoryDiffHead.billno))
			#set($billno = "自动生成")
			#set($orgId = $StringUtil.getOrgId($session))
			#set($dodate = $DateUtil.getCurrentDate10())
			#set($createDate = $DateUtil.getCurrentDate10())
			#set($createdId = $StringUtil.getUserId($session))
			#set($status = "保存")
		#else
			#set($billno = $inventoryDiffHead.billno)
			#set($orgId = $inventoryDiffHead.orgId)
			#set($dodate = $inventoryDiffHead.dodate)
			#set($createDate = $inventoryDiffHead.createDate)
			#set($createId = $!inventoryDiffHead.createId)
			#set($status = $!DictUtil.getValue('status', $!{inventoryDiffHead.status}))
		#end
		
    	<tr>
			<td class='body1'>单据编号：</td>
			<td class='body2'>
				<input type='text' id="billno" name='billno' readonly value="$!billno">
			</td>
			<td class='body1'>单据状态：</td>	
			<td class='body2'>
				<input type='text' id="status" name='status' readonly value="$!status">
			</td>
			<td class='body1'>创建日期：</td>
			<td class='body2'>
				<input type='text' id="createDate" name='createDate' readonly value="$!{createDate}" dataType="Require" msg="不能为空">
			</td>
			<td class='body1'>创建人员:</td>	
			<td class='body2'>
				<input type='hidden' id="createId" name='createId' value="$!{createId}">
				<input type='text' id="createName" name='createName'  value="$!BdCommon.getUserName($!createId)" readonly  dataType="Require" msg="不能为空" >
			</td>
		</tr>
		<tr>
			<td class='body1'>单据日期：</td>
			<td class='body2'>
				<input type='text' id="dodate" name='dodate' readonly value="$!{dodate}" dataType="Require" msg="不能为空">
			</td>
			<td class='body1'>库存组织:</td>	
			<td class='body2'>
				<input type='hidden' id="orgId_1" name='orgId_1' value="$!{orgId}">
				<input type='text' id="orgName" name='orgName'  value="$!BdCommon.getOrgName($orgId)" readonly  dataType="Require" msg="不能为空" >
			</td>
			<td class='body1'>盘点仓库：</td>
			<td class='body2'>
				<select id="stockId" name="stockId" disabled >$StringUtil.emptyOption()</select>
				$StringUtil.star()
			</td>
			<td class='body1'>件数合计：</td>
			<td class='body2'>
				<input type='text' id="sumCount" name='sumCount' readonly value="$!{inventoryDiffHead.sumCount}">
			</td>
		</tr>
    </table>
	
	<table class='search-tb'>
        <tr><td>>> 查询条件</td></tr>
    </table>
	<table class='content'>
		#set($cond = $form.condition)
		#set($itemClassId = $!cond.get('itemClassId'))
		#set($ornaClassId = $!cond.get('ornaClassId'))
		#set($groups = $!cond.get('groups'))
		#set($orgId = $!cond.get('orgId'))
		#set($ornaCode = $!cond.get('ornaCode'))
		
		#set($bill_no = $!cond.get('bill_no'))
		#set($bill_type = $!cond.get('bill_type'))
		#set($diffSignState = $!cond.get('diffSignState'))
		#set($state = $!cond.get('state'))
		<tr>
			<td class='body1'>饰品编码：</td>
			<td class='body2'>
				<input type="text" id="ornaCode" name="ornaCode" value="$!ornaCode"/>
			</td>
			<td class='body1'>大类：</td>
			<td class='body2'>
				<select id="itemClassId" name="itemClassId" dataType="Require" value="$!BdCommon.getItemClassDesc($!itemClassId)" msg="不能为空">$StringUtil.emptyOption()</select>
			</td>
			<td class='body1'>小类：</td>
			<td class='body2'>
				<select id="ornaClassId" name="ornaClassId" dataType="Require" value="$!BdCommon.getOrnaClassDesc($!ornaClassId)" msg="不能为空">$StringUtil.emptyOption()</select>
			</td>
			<td class='body1'>柜组：</td>
			<td class='body2'>
				<select id="groups" name="groups" dataType="Require" value="$!DictUtil.getValue('group', $!groups)" msg="不能为空">$StringUtil.emptyOption()</select>
			</td>
			<td class='body1' rowspan="2">
				<input type='hidden' name="user_action" value='doNoStockList' />
				<input type="hidden" name="orgId" value="$!orgId"/>
				<input type='button' value='查询' class='btn' id='btnSearch' style="width:60px;">
			</td>
        </tr>
		<tr>
			<td class='body1'>单据编码：</td>
			<td class='body2'>
				<input type="text" id="bill_no" name="bill_no" value="$!bill_no"/>
			</td>
			<td class='body1'>单据类型：</td>
			<td class='body2'>
				<select id="bill_type" name="bill_type"></select>
			</td>
			<td class='body1'>盘盈盘亏：</td>
			<td class='body2'>
				<select id="diffSignState" name="diffSignState">
					<option value="">--请选择--</option>
					<option value="1">盘盈</option>
					<option value="0">盘亏</option>
                </select>
			</td>
			<td class='body1'>饰品状态：</td>
			<td class='body2'>
				<select id="state" name="state">
					<option value="">--请选择--</option>
					<option value="900">有效</option>
					<option value="901">在途</option>
                </select>
			</td>
		</tr>
    </table>
	<table class='list'>
    	<thead>
			<tr>
				<th></th>
				<th>饰品编码</th>
        		<th>饰品名称</th>
				<th>大类</th>
				<th>小类</th>
				<th>柜组</th>
				<th>款式</th>
                <th>分析范围</th>
				<th>计量单位</th>
				<th>现有量</th>
				<th>总重量</th>
				<th>粒数</th>
				<th>销售金额</th>
				<th>主石重量</th>
        		<th>配石重量</th>
				<th>状态</th>
				<th>单据类型</th>
				<th>单据编号</th>
				<th>盘盈</th>
            </tr>
        </thead>
        <tbody id="tbl_old_mater">
		#foreach($line in $lines)
			<tr>
				<td></td>
				<td>$!line.ornaCode</td>
				<td>$!line.ornaDsc</td>
				<td>$!line.itemClassName</td>
				<td>$!line.ornaClassName</td>
				<td>$!DictUtil.getValue('group', $line.groups)</td>
				<td>$!HtmlUtil.printStyle($!line.styleId, $!line.styleName, $!line.bigGraph)</td>
				<td>$!line.alaysisName</td>
				<td>$!line.unitName</td>
                <td>$!line.nowQty</td>
				<td>$!line.allQty</td>
				<td>$!line.grains</td>
				<td>$!line.posMoney</td>
				<td>$!line.mainWeight</td>
				<td>$!line.partWeight</td>
				<td>$!DictUtil.getValue('status', $!line.ornaState)</td>
				<td>$!DictUtil.getValue('billcode', $!line.billCode)</td>
				<td>$!line.billNo</td>
				<td #if("$!line.diffSign" == "1")style="color:red;"#else style="color:blue;"#end>#if("$!line.diffSign" == "1")盘盈#else盘亏#end</td>
			</tr>
		#end
    	</tbody>
    </table>
<script>
createPagingToolbar('frm', $!form.pager.start, $!form.pager.limit, $!form.pager.totalCount);
</script>
</form>
<script>
function changeItemClass(ornaValue){
	BdCommonDwr.getAllOrnaClassForSlt(jQuery("#itemClassId").val(), function(data){
		addOptions("ornaClassId", data, null, null, true, true, ornaValue);
	});
}
function setValues(){
	BdCommonDwr.getAllItemClassForSlt(function(data){
		addOptions("itemClassId", data, null, null, true, true, "$!itemClassId");
    	changeItemClass("$!ornaClassId");
	});
	DictDwr.getDictsForSlt("invcode", function(data){
		addOptions("stockId",  data, null, null, true, true, "$!inventoryDiffHead.stockId");
	});
	
	DictDwr.getDictsForSlt("billcode", function(data){
		addOptions("bill_type",  data, null, null, true, true, "$!bill_type");
	});
	jQuery("#diffSignState").val("$!diffSignState");
	jQuery("#state").val("$!state");
}

function setGroups(groupVal){
	DictDwr.getDictsForSlt('group', function(data){
		addOptions("groups", data, null, null, true, true, groupVal);
	});
}
jQuery(function(){
	jQuery("#itemClassId").change(changeItemClass);
	
	setGroups("$!DictUtil.getValue('group', $!groups)");
	
	setValues();
})

jQuery(function(){
	altRowCSS('tbl_old_mater');//为列表添加换行样式
	jQuery("#stockId").val("$!inventoryDiffHead.stockId");
	
	jQuery("#btnToList").click(function(){
		window.location = "procInventory.vm?user_action=showDiffBill&sourceNo=$!inventoryDiffHead.sourceNo";
	});
	jQuery("#btnSearch").click(function(){
		jQuery("#frm").submit();
	});
	changeSeq("tbl_old_mater");
})

function changeSeq(tblId){
	var len = $(tblId).rows.length;
	for(var i=0; i<len; i++){
		$(tblId).rows[i].cells[0].innerHTML = len-i;
	}
}
</script>